<?php
// $Id$

/**
 * @file
 * Creates settings page and inserts the javascript onto the site's pages.
 */

function beautytips_admin() {
  $form['beautytips_turnon'] = array(
    '#type' => 'checkbox',
    '#title' => 'Turn on Beauty Tips',
    '#default_value' => variable_get('beautytips_turnon', FALSE),
  );
  $form['beautytips_drupal_help'] = array(
    '#type' => 'checkbox',
    '#title' => 'Turn on help link popups',
    '#default_value' => variable_get('beautytips_drupal_help', FALSE),
  );
  $form['beautytips_direction'] = array(
    '#type' => 'radios',
    '#title' => 'Which side should the popup appear on?',
    '#options' => array('bottom' => t('bottom'), 'top' => t('top'), 'left' => t('left'), 'right' => t('right')),
    '#default_value' => variable_get('beautytips_direction', 'bottom'),
  );
  return system_settings_form($form);
}

/**
 * Implementation of hook_menu.
 */
function beautytips_menu() {
  $items = array();
  $items['admin/settings/beautytips'] = array(
    'title' => 'Beauty Tips settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('beautytips_admin'),
    'access arguments' => array('administer site configuration'),
  );
  return $items;
}
 
/**
 * Implementation of hook_form_alter.
 */
function beautytips_form_alter(&$form, $form_state, $form_id) {
  if (variable_get('beautytips_turnon', FALSE)) {
    // Add the jQuery script for the popups, pass variables into javascript
    $path = drupal_get_path('module', 'beautytips');
    drupal_add_js("var bt_direction = " . drupal_to_js(variable_get('beautytips_direction', 'bottom')) . ";", 'inline');
    drupal_add_js("var bt_drupal_help = " . drupal_to_js(variable_get('beautytips_drupal_help', FALSE)) . ";", 'inline');
    drupal_add_js( $path .'/jquery.bt.js');
    drupal_add_js( $path .'/beautytips.js');
    drupal_add_js( $path .'other_libs/excanvas_002/excanvas.js');
    drupal_add_css($path .'/jquery.bt.css');
  }
}
